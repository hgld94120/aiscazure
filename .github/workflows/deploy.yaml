name: Build and Push React Application to ACR

on:
  push:
    branches: [ main ]

env: 
  IMAGE_TAG: latest

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
            
      - name : resolve DNS
        run : |
          nslookup ${{ secrets.ACR_NAME }}.azurecr.io
        
      - name: Log in to Azure Container Registry
        run: |
          echo ${{ secrets.ACR_PASSWORD }} | docker login \
            ${{ secrets.ACR_NAME }} \
            -u ${{ secrets.ACR_USERNAME }} \
            --password-stdin
      
      - name: Build Docker image
        run: |
          docker build -t ${{ secrets.ACR_NAME }}/${{ secrets.IMAGE_NAME }}:${{ env.IMAGE_TAG }} .
      
      - name: Push image to ACR
        run: |
          docker push ${{ secrets.ACR_NAME }}/${{ secrets.IMAGE_NAME }}:${{ env.IMAGE_TAG }}